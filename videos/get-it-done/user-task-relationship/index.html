<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Get It Done! Part 9: The User-Task Relationship :: Unit 2: Web Fundamentals</title>

        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <link rel="stylesheet" href="/css/highlight.launchcode.css">
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="https://djwbyvgln9kts.cloudfront.net/launch_ed_style/custom.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <ul class="nav navbar-nav">

                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle glyphicon glyphicon-menu-hamburger" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu">
                                                            <li class=" lc-button">
                                    <a href="/classes/">
                                        Classes
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="/studios/">
                                        Studios
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="/tutorials/">
                                        Tutorials
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="/assignments/">
                                        Assignments
                                    </a>
                                </li>
                                                            <li class="active lc-button">
                                    <a href="/videos/">
                                        Videos
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="/cheatsheets/">
                                        Cheatsheets
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="/objectives/">
                                        Objectives
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="/issues/">
                                        Issues
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="/about/">
                                        About this Unit
                                    </a>
                                </li>
                                                        <li role="separator" class="divider"></li>
                            <li>
                                <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch">Search This Site</a>
                            </li>
                        </ul>
                    </li>

                
            </ul>


            <div>
                <a class="navbar-brand site-title navbar-center" href="/">
                    <h1>Unit 2: Web Fundamentals</h1>
                </a>
            </div>

            <div class="nav navbar-nav navbar-right">
                <a class="navbar-brand dabomb" href="/"></a>
            </div>

        </header>

        <nav style="position:absolute; width: 180px; margin-top:64px">
            <ul class="nav navbar-big-nav hidden-md hidden-sm hidden-xs">
                                                            <li class=" lc-button">
                            <a href="/classes/">
                                Classes
                            </a>
                        </li>
                                            <li class=" lc-button">
                            <a href="/studios/">
                                Studios
                            </a>
                        </li>
                                            <li class=" lc-button">
                            <a href="/tutorials/">
                                Tutorials
                            </a>
                        </li>
                                            <li class=" lc-button">
                            <a href="/assignments/">
                                Assignments
                            </a>
                        </li>
                                            <li class="active lc-button">
                            <a href="/videos/">
                                Videos
                            </a>
                        </li>
                                            <li class=" lc-button">
                            <a href="/cheatsheets/">
                                Cheatsheets
                            </a>
                        </li>
                                            <li class=" lc-button">
                            <a href="/objectives/">
                                Objectives
                            </a>
                        </li>
                                            <li class=" lc-button">
                            <a href="/issues/">
                                Issues
                            </a>
                        </li>
                                            <li class=" lc-button">
                            <a href="/about/">
                                About this Unit
                            </a>
                        </li>
                                        <li role="separator" class="divider"></li>
                    <li>
                        <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch">Search This Site</a>
                    </li>
                            </ul>
        </nav>


        <!-- Search Modal -->
        <div id="modalSearch" class="modal fade" role="dialog">
           <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
                   <h4 class="modal-title">Search Unit 2: Web Fundamentals</h4>
                </div>
                <div class="modal-body">
                    <script>
                      (function() {
                        var cx = "018398152828724587795:xxg-p_lz3vg";
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                      })();
                    </script>
                    <gcse:search></gcse:search>
                </div>
                <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

           </div>
        </div>

        <main class="container-fluid">
            <div class="row">

                <section id="content" class="col-sm-offset-1 col-sm-10 col-md-offset-2 col-md-8">
                                        <h1>Get It Done! Part 9: The User-Task Relationship</h1>
                    <h2 id="important-note">Important Note:</h2>
<h3 id="this-series-of-videos-uses">This series of videos uses <code>MAMP</code>, <code>PHPMyAdmin</code>, and <code>MySQL</code>.  <strong>WE ARE NOT USING THESE TOOLS.</strong> Instead we are using <code>TablePlus</code> and <code>Sqlite3</code>.</h3>
<div class="youtube-wrapper"><iframe width="776" height="437" src="https://www.youtube-nocookie.com/embed/rTUnjM7HaVg?rel=0" frameborder="0" allowfullscreen></iframe></div>
<h2 id="notes">Notes</h2>
<p>In this lesson we make the connection between user objects and task objects. Each user has (potentially) many task objects, therefore we want to think about this relationship in terms of one-to-many. To move our application in this direction, we'll take the following steps:</p>
<ul>
<li>
<p>Refactor the <code>Task</code> class so that it has an <code>owner_id</code> property and takes an <code>owner</code> as an argument to its constructor:</p>
<pre><code class="language-python">class Task(db.Model):

id = db.Column(db.Integer, primary_key=True)
name = db.Column(db.String(120))
completed = db.Column(db.Boolean)
owner_id = db.Column(db.Integer, db.ForeignKey('user.id'))

def __init__(self, name, owner):
    self.name = name
    self.completed = False
    self.owner = owner</code></pre>
</li>
<li>
<p>Specify that a user has many tasks and you want SQLAlchemy to look for matches between the two by adding this line in the <code>User</code> class:</p>
<pre><code class="language-python"> tasks = `db.relationship('Task', backref='owner')`</code></pre>
</li>
<li>
<p>Since we've changed our model classes, we'll need to drop and create our tables again (using the Python shell commmands that should be familiar by now). Then create a user and a task object/record in the shell. If you need a reminder of this process, review the second and third bullet items <a href="../../../studios/flicklist/6/#modify-flicklist-to-store-movie-ratings">here</a>.</p>
</li>
<li>
<p>In the <code>POST</code> handler of the <code>index</code> function, add code to get the owner of the task so that you can pass that into the <code>Task</code> constructor. Also, you'll want to modify the code so that it only grabs tasks from the database that belong to the current user:</p>
<pre><code class="language-python">@app.route('/', methods=['POST', 'GET'])
def index():

    owner = User.query.filter_by(email=session['email']).first()

    if request.method == 'POST':
        task_name = request.form['task']   
        new_task = Task(task_name, owner)
        db.session.add(new_task)
        db.session.commit()

    tasks = Task.query.filter_by(completed=False,owner=owner).all()
    completed_tasks = Task.query.filter_by(completed=True,owner=owner).all()
    return render_template('todos.html', title="Get It Done!", 
        tasks=tasks, completed_tasks=completed_tasks)</code></pre>
</li>
</ul>
<p>Congratulations! You've learned the basics of creating web apps! What you've learned so far will allow you to write many cool programs. And as we add more skills to our coding repertoire in the next few classes, you'll take your web dev skills to the level of a beginning professional.</p>
<h2 id="code">Code</h2>
<p>View the <a href="https://github.com/devetrycodeforward/get-it-done/tree/6b54b2bd08ba9ad65537003af7d8f03d3fd3559e">final code</a> for this lesson.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="http://flask-sqlalchemy.pocoo.org/2.1/models/#one-to-many-relationships">One-to-Many Relationship in Flask-SQLAlchemy</a></li>
<li><a href="http://flask-sqlalchemy.pocoo.org/2.1/binds/#creating-and-dropping-tables">Creating and Dropping Tables</a></li>
</ul>
                                    </section>

            </div>
        </main>

        <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="/js/highlight.pack.js"></script>
        <script type="text/javascript" src="/js/libgif.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.3/vue.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');

                // Syntax highlighting
                hljs.configure({ displayLabels: true });
                hljs.initHighlightingOnLoad();
            });
        </script>
        <script>
            $(function() {
                if (!location.pathname.match(/class-prep/)) return;

                window.checkboxWatcher = new Vue({
                    el: '#content',
                    data: function() {
                        var storedValue = localStorage.getItem('completedChecks');
                        console.log('storedValue', storedValue);
                        var hydratedValue = storedValue ? JSON.parse(storedValue) : {};
                        return {
                            checks: hydratedValue,
                        };
                    },
                    watch: {
                        checks: {
                            handler: function() {
                                console.log('storing check state');
                                localStorage.setItem('completedChecks', JSON.stringify(this.checks));
                            },
                            deep: true,
                        },
                    },
                });
            });
        </script>
        
    </body>
</html>
